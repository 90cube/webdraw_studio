# 객체 속성 및 모드 (Object Properties & Modes)

## 1. 개요
Fabric.js 캔버스 객체에 사용자 정의 속성을 추가하고 관리하는 방법을 정의합니다. 특히 'Image Mode' 속성을 통해 객체의 역할을 정의하고 시각적으로 피드백을 제공합니다.

## 2. 주요 기능

### 2.1. 사용자 정의 속성 `imageMode`
- **정의:** 각 Fabric.js 객체는 `imageMode`라는 사용자 정의 속성을 가집니다.
- **목적:** 이 속성은 객체가 이미지 생성 파이프라인에서 어떤 역할(마스크, 전처리 소스, 참조 등)을 하는지 정의합니다.
- **직렬화:** `fabric.Object.customProperties.push('imageMode')` 코드를 통해 `imageMode` 속성이 캔버스 저장/불러오기 시에도 유실되지 않고 유지되도록 합니다.

### 2.2. Image Mode 정의 및 관리
- **모드 종류:**
    - `image`: 이미지 (I2I) - 기본값
    - `mask`: 마스크
    - `preprocessor`: 전처리 소스
    - `controlnet`: 컨트롤넷 소스
    - `reference`: 참조 (잠금)
- **속성:** 각 모드는 이름(`name`), 잠금 여부(`lock`), 배지 정보(`badge`)를 가집니다.

### 2.3. 객체 잠금/해제
- **트리거:** 객체의 `imageMode`가 `reference`로 설정될 때.
- **동작:** `reference` 모드의 객체는 이동, 크기 조절, 회전 등 모든 상호작용이 불가능하도록 잠깁니다. 다른 모드로 변경 시 잠금이 해제됩니다.

### 2.4. 모드 배지 시각화
- **위치:** 캔버스에서 선택된 객체의 좌측 상단에 표시됩니다.
- **구성:** 각 모드를 나타내는 한 글자 알파벳(I, M, P, C, R)과 해당 모드에 고유한 색상으로 구성된 작은 사각형 배지입니다.
- **동작:** 객체 선택 시 배지가 나타나고, 모드 변경 시 즉시 업데이트됩니다.
- **구현 방식:** HTML 요소를 사용하는 대신, Fabric.js의 `after:render` 이벤트를 활용하여 캔버스에 직접 그려지므로 성능이 우수합니다.

### 2.5. 키보드 단축키를 통한 모드 변경
- **트리거:** 캔버스에서 객체를 선택한 후 특정 키를 누릅니다.
- **단축키:**
    - `M`: 마스크 (Mask)
    - `P`: 전처리 소스 (Preprocessor Source)
    - `C`: 컨트롤넷 소스 (ControlNet Source)
    - `R`: 참조 (Reference / Locked)
- **동작:** 해당 키 입력 시 선택된 객체의 `imageMode`가 변경됩니다.
