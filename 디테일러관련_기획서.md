# WebDraw Studio 디테일러 파라미터 명세서

`apply_detailer` 작업은 이미지의 특정 부분을 감지하여 고품질로 다시 그리는 후처리 단계입니다. 이 작업을 위해 프론트엔드는 아래에 정의된 파라미터들을 백엔드로 전달해야 합니다.

## 1. 탐지 (Detection) 그룹

> 이미지의 어느 부분을 수정할지 찾아내는 단계입니다.

| **파라미터명**         | **타입** | **설명**                                                                                           | **기본값**           | **중요도** |
| ----------------- | ------ | ------------------------------------------------------------------------------------------------ | ----------------- | ------- |
| `detection_model` | String | 객체 탐지에 사용할 모델 파일명입니다. (예: `face_yolov8n.pt`, `hand_yolov8n.pt`) 이 목록은 백엔드 API를 통해 동적으로 받아와야 합니다. | `face_yolov8n.pt` | **필수**  |
| `confidence`      | Float  | 탐지 모델의 신뢰도 임계값입니다. 이 값보다 높은 신뢰도를 가진 객체만 처리 대상이 됩니다. 값이 너무 낮으면 원하지 않는 영역이 포함될 수 있습니다.             | `0.3`             | **중요**  |

## 2. 마스크 처리 (Mask Preprocessing) 그룹

> 탐지된 영역(마스크)을 인페인팅에 적합하도록 다듬는 단계입니다.

| **파라미터명**      | **타입**  | **설명**                                                                                                                            | **기본값** | **중요도** |
| -------------- | ------- | --------------------------------------------------------------------------------------------------------------------------------- | ------- | ------- |
| `mask_padding` | Integer | 탐지된 마스크 영역을 확장하거나 축소할 픽셀 값입니다. **양수**는 확장, **음수**는 축소를 의미합니다. 영역을 살짝 확장하면 더 자연스러운 결과물을 얻을 수 있습니다. (ADetailer의 `dilate/erode`와 유사) | `32`    | **중요**  |
| `mask_blur`    | Integer | 마스크의 경계를 부드럽게 처리할 값입니다. 인페인팅 결과물이 주변 픽셀과 자연스럽게 섞이도록 도와줍니다.                                                                        | `4`     | **중요**  |

## 3. 인페인팅 (Inpainting) 그룹

> 마스크 처리된 영역을 새로운 프롬프트로 다시 그리는 핵심 단계입니다.

| **파라미터명**            | **타입**  | **설명**                                                                                                | **기본값**   | **중요도** |
| -------------------- | ------- | ----------------------------------------------------------------------------------------------------- | --------- | ------- |
| `prompt`             | String  | **디테일러 전용** 긍정 프롬프트입니다. 비워두면 메인 프롬프트를 사용합니다. (예: `a beautiful detailed face, masterpiece`)            | `""`      | **필수**  |
| `negative_prompt`    | String  | **디테일러 전용** 부정 프롬프트입니다. 비워두면 메인 부정 프롬프트를 사용합니다.                                                       | `""`      | **필수**  |
| `denoising_strength` | Float   | **가장 중요한 파라미터.** 원본 이미지의 형태를 얼마나 유지할지 결정합니다. 값이 높을수록 프롬프트의 영향을 많이 받아 이미지가 크게 변하고, 낮을수록 원본의 형태가 유지됩니다. | `0.4`     | **필수**  |
| `steps`              | Integer | 인페인팅에 사용할 샘플링 스텝 수입니다. 메인 스텝과 별개로 설정할 수 있습니다.                                                         | `25`      | 고급      |
| `cfg_scale`          | Float   | 인페인팅 시 프롬프트를 얼마나 따를지 결정하는 값입니다. 메인 CFG와 별개로 설정할 수 있습니다.                                               | `7.0`     | 고급      |
| `sampler`            | String  | 인페인팅에 사용할 샘플러입니다. 메인 샘플러와 다른 것을 선택할 수 있습니다.                                                           | `Euler a` | 고급      |

### 최종 `task_list` 예시

위 파라미터들을 조합하면, 프론트엔드가 생성할 `task_list`의 `apply_detailer` 작업은 다음과 같은 형태가 됩니다.

```
{
    "name": "apply_detailer",
    "params": {
        "detection_model": "face_yolov8n.pt",
        "confidence": 0.35,
        "mask_padding": 24,
        "mask_blur": 4,
        "prompt": "perfect eyes, beautiful detailed face",
        "negative_prompt": "blurry, ugly, deformed",
        "denoising_strength": 0.45,
        "steps": 20,
        "cfg_scale": 7.0,
        "sampler": "DPM++ 2M Karras"
    }
}
```

이제 이 명세서를 기준으로 `multiDetailer.js` 패널에 UI 컴포넌트(슬라이더, 드롭다운, 텍스트 입력)를 추가하고, `generationExecutor.js`에서 해당 값들을 수집하여 위와 같은 JSON 구조를 만들도록 구현하시면 됩니다.
